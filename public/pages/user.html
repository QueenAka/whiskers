<!doctype html>
<html>
  <head>
    <title>Whiskers | Login</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="/emojis/1.png" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="30"
        height="30"
        fill="currentColor"
        class="user"
        viewBox="0 0 16 16"
        onclick="goto('/pages/user')"
      >
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
        <path
          fill-rule="evenodd"
          d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"
        />
      </svg>
      <a id="home" href="/">
        <div class="logo"></div>
        Whiskers
      </a>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="30"
        height="30"
        fill="currentColor"
        class="settings"
        viewBox="0 0 16 16"
        onclick="goto('/pages/settings')"

      >
        <path
          d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"
        />
      </svg>
    </nav>
    <div class="center">
      <div class="lgin">
        <h3>Username</h3>
        <input placeholder="Username" id="username" type="text"/>
        <h3>Password</h3>
        <input placeholder="Password" id="password" type="password" /><br>
        <button id="login" onclick="login()">Login</button> 
        <button id="signup" onclick="signup()">Sign up</button>
        <center><div id="err"></div></center>
      </div>
    </div>
    <script>
      function err(msg){
        let div = document.getElementById("err");
        div.innerHTML = msg;
      }

      function checkName(name){
        if(name.length < 3){
          err("Username must be at least 3 characters long");
          return false;
        }
        if(name.length > 20){
          err("Username must be less than 20 characters long");
          return false;
        }
        if(name.match(/[^a-z0-9_]/g)){
          err("Username can only contain lowercase letters, numbers, and underscores");
          return false;
        }
        return true;
      }
      
      function login() {
        err('')
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;
        fetch("/api/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username: username,
            password: password,
          }),
        }).then(res => res.json())
        .then(data => {
          if(data.error) return err(`${data.error}`)
          localStorage.setItem("userData", JSON.stringify(data.user));
          localStorage.setItem("name", data.name);
          goto('settings')
        })
      }

      function signup() {
        err('')
        let username = document.getElementById("username").value;
        if(!checkName(username)) return
        let password = document.getElementById("password").value;
        fetch("/api/signup", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username: username,
            password: password,
          }),
        }).then(res => res.json())
        .then(data => {
          if(data.error) return err(`${data.error}`)
          localStorage.setItem("userData", JSON.stringify(data.user));
          localStorage.setItem("name", data.name);
        goto('settings')
          })
      }

    </script>
  </body>
  <script src="/js/script.js"></script>
  <script src="/js/all.js"></script>
</html>
