<!doctype html>
<html>
  <head>
    <title>Whiskers | Login</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="/emojis/1.png" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav>
      <img
        width="30px"
        height="30px"
        class="user"
        onclick="goto('/pages/user')"
        src="/media/image/profile.png"
      />
      <a id="home" href="/">
        <img class="logo" src="/media/image/logo.png" />
        Whiskers
      </a>
      <img
        width="30px"
        height="30px"
        class="settings"
        onclick="goto('/pages/settings')"
        src="/media/image/settings.png"
      />
    </nav>
    <div class="center">
      <div class="lgin">
        <h3>Username</h3>
        <input placeholder="Username" id="username" type="text" />
        <h3>Password</h3>
        <input placeholder="Password" id="password" type="password" /><br />
        <button id="login" onclick="login()">Login</button>
        <button id="signup" onclick="signup()">Sign up</button>
        <center><div id="err"></div></center>
      </div>
    </div>
    <script>
      function err(msg) {
        let div = document.getElementById("err");
        div.innerHTML = msg;
      }

      function checkName(name) {
        if (name.length < 3) {
          err("Username must be at least 3 characters long");
          return false;
        }
        if (name.length > 20) {
          err("Username must be less than 20 characters long");
          return false;
        }
        if (name.match(/[^a-z0-9_]/g)) {
          err(
            "Username can only contain lowercase letters, numbers, and underscores",
          );
          return false;
        }
        return true;
      }

      function login() {
        err("");
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;
        fetch("/api/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username: username,
            password: password,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) return err(`${data.error}`);
            localStorage.setItem("userData", JSON.stringify(data.user));
            localStorage.setItem("name", data.name);
            goto("settings");
          });
      }

      function signup() {
        err("");
        let username = document.getElementById("username").value;
        if (!checkName(username)) return;
        let password = document.getElementById("password").value;
        fetch("/api/signup", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username: username,
            password: password,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) return err(`${data.error}`);
            localStorage.setItem("userData", JSON.stringify(data.user));
            localStorage.setItem("name", data.name);
            goto("settings");
          });
      }
    </script>
  </body>
  <script src="/js/script.js"></script>
  <script src="/js/all.js"></script>
</html>
