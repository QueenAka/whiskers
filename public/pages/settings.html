<!doctype html>
<html>
  <head>
    <title>Whiskers | Settings</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="/emojis/1.png" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="30"
        height="30"
        fill="currentColor"
        class="user"
        viewBox="0 0 16 16"
        onclick="goto('/pages/user')"
      >
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
        <path
          fill-rule="evenodd"
          d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"
        />
      </svg>
      <a id="home" href="/">
        <div class="logo"></div>
        Whiskers
      </a>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="30"
        height="30"
        fill="currentColor"
        class="settings"
        viewBox="0 0 16 16"
        onclick="goto('/pages/settings')"
      >
        <path
          d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"
        />
      </svg>
    </nav>
    <div class="sttn">
      <div class="lined">Customization</div>
      <h3>Display name <input type="text" id="displayName" /></h3>
      <h3>Name color</h3>
      <input type="color" id="nameColor" />
      <div class="lined">Notifications</div>
      <h3>
        Play notifacation sounds <input type="checkbox" id="notifSounds" />
      </h3>
      <h3>Notifacation sound</h3>
      <select id="notifSound">
        <option value="meow.mp3">Meow</option>
        <option value="bark.mp3">Bark</option>
        <option value="bonk.mp3">Bonk</option>
        <option value="ding.mp3">Ding</option>
      </select>
      <br /><br />
      <button onclick="save()">Save</button>
      <button onclick="reset()">Reset</button>
      <button onclick="logout()">Log out</button>
    </div>
    <script>
      function logout() {
        localStorage.removeItem("userData");
        localStorage.removeItem("name");
        notif("Logging out...");
        setTimeout(() => {
          goto("/pages/user");
        }, 500);
      }

      let settings = JSON.parse(localStorage.getItem("userData"));
      if (!settings) {
        goto("/pages/user");
      }
      document.getElementById("displayName").value = settings.displayName;
      document.getElementById("nameColor").value = settings.settings.nameColor;
      document.getElementById("notifSounds").checked =
        settings.settings.notifSounds;
      document.getElementById("notifSound").value =
        settings.settings.notifSound;

      function save() {
        let displayName = document.getElementById("displayName").value;
        let sttns = {
          nameColor: document.getElementById("nameColor").value,
          notifSounds: document.getElementById("notifSounds").checked,
          notifSound: document.getElementById("notifSound").value,
        };
        settings.settings = sttns;
        settings.displayName = displayName;
        fetch("/api/update", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            json: settings,
            username: localStorage.getItem("name"),
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.res == "Success") {
              localStorage.setItem("userData", JSON.stringify(settings));
              reload("Settings saved");
            } else {
              reload("Failed to save settings");
            }
          });
      }

      function reload(txt) {
        let uuserData = JSON.parse(localStorage.getItem("userData"));
        document.getElementById("displayName").value = uuserData.displayName;
        document.getElementById("nameColor").value =
          uuserData.settings.nameColor;
        document.getElementById("notifSounds").checked =
          uuserData.settings.notifSounds;
        document.getElementById("notifSound").value =
          uuserData.settings.notifSound;
        notif(txt);
      }

      function reset() {
        let sttns = {
          nameColor: "#f1f1f1",
          notifSounds: true,
          notifSound: "meow.mp3",
        };
        settings.settings = sttns;
        localStorage.setItem("userData", JSON.stringify(settings));
        fetch("/api/update", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            json: settings,
            username: localStorage.getItem("name"),
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.res == "Success") {
              reload("Settings reset");
            } else {
              reload("Failed to reset settings");
            }
          });
      }
    </script>
  </body>
  <script src="/js/script.js"></script>
  <script src="/js/all.js"></script>
</html>
