<!doctype html>
<html>
  <head>
    <title>Whiskers</title>
    <link rel="icon" type="image/png" href="/media/image/icons/logo.png" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="og:title" content="Whiskers" />
    <meta name="og:description" content="Whiskers - Super Secret Messaging" />
    <meta name="og:image" content="/media/image/icons/logo.png" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav>
      <img
        width="30px"
        height="30px"
        class="user"
        onclick="goto('/pages/user')"
        src="/media/image/icons/profile.png"
      />
      <a id="home" href="/">
        <img class="logo" src="/media/image/icons/logo.png" />
        Whiskers
      </a>
      <img
        width="30px"
        height="30px"
        class="settings"
        onclick="goto('/pages/settings')"
        src="/media/image/icons/settings.png"
      />
    </nav>
    <div class="tabs">
      <div
        class="tab active"
        id="tab-news"
        onclick="select(this.id.split('-')[1])"
      >
        News
      </div>
      <div
        class="tab"
        id="tab-publicChats"
        onclick="select(this.id.split('-')[1])"
      >
        Public
      </div>
      <div
        class="tab"
        id="tab-joinChat"
        onclick="select(this.id.split('-')[1])"
      >
        Join
      </div>
      <div
        class="tab"
        id="tab-createChat"
        onclick="select(this.id.split('-')[1])"
      >
        Create
      </div>
    </div>
    <div id="news" class="cards"></div>
    <div id="publicChats" class="cards" style="display: none"></div>
    <div id="joinChat" style="display: none">
      <center class="center">
        <h3>Join a Chat</h3>
        <input placeholder="Chat ID..." type="text" id="joinId" />
        <button
          onclick="goto(`/chats/${document.getElementById('joinId').value}`)"
        >
          Join
        </button>
      </center>
    </div>
    <div id="createChat" style="display: none">
      <center class="center">
        <h2>Create a Chat</h2>
        <h3>Chat Name</h3>
        <input placeholder="Chat name..." type="text" /> <button>Create</button>
        <warn>THIS DOES NOT CURRENTLY DO ANYTHING</warn>
      </center>
    </div>
    <script src="/js/all.js"></script>
    <script>
      function select(id) {
        const tabs = [
          "tab-news",
          "tab-publicChats",
          "tab-joinChat",
          "tab-createChat",
        ];
        tabs.forEach((tabId) =>
          document.getElementById(tabId).classList.remove("active"),
        );
        const contentIds = ["news", "publicChats", "joinChat", "createChat"];
        contentIds.forEach(
          (contentId) =>
            (document.getElementById(contentId).style.display = "none"),
        );
        const selectedTabId = `tab-${id}`;
        const selectedContentId = id;
        document.getElementById(selectedTabId).classList.add("active");
        document.getElementById(selectedContentId).style.display = "block";
      }

      setTimeout(() => {
        fetch("/api/updates")
          .then((res) => res.json())
          .then((data) => {
            data.forEach(async (update) => {
              const updateDiv = document.createElement("div");
              updateDiv.classList.add("chat-card");

              const updateHead = document.createElement("div");
              updateHead.classList.add("head");

              const updateTitle = document.createElement("h3");
              updateTitle.innerHTML = clean(update.name);
              updateTitle.classList = "name";

              const updateTimestamp = document.createElement("p");
              updateTimestamp.innerHTML = `${update.timestamp}`;
              updateTimestamp.classList = "author";

              updateHead.appendChild(updateTitle);
              updateHead.appendChild(updateTimestamp);

              const updateDescription = document.createElement("div");
              updateDescription.innerHTML = clean(update.description);
              updateDescription.classList = "desc";

              updateDiv.appendChild(updateHead);
              updateDiv.appendChild(updateDescription);
              document.getElementById("news").appendChild(updateDiv);
            });
          });

        fetch("/api/chats")
          .then((res) => res.json())
          .then((data) => {
            data.forEach(async (chat) => {
              const chatDiv = document.createElement("div");
              chatDiv.classList.add("chat-card");

              const chatHead = document.createElement("div");
              chatHead.classList.add("head");

              const chatTitle = document.createElement("h3");
              chatTitle.innerHTML = clean(chat.name);
              chatTitle.classList = "name";

              const chatAuthor = document.createElement("p");
              chatAuthor.innerHTML = `@${chat.author}`;
              chatAuthor.classList = "author";

              chatHead.appendChild(chatTitle);
              chatHead.appendChild(chatAuthor);

              const chatDescription = document.createElement("p");
              chatDescription.innerHTML = clean(chat.description);
              chatDescription.classList = "desc";

              chatDiv.appendChild(chatHead);
              chatDiv.appendChild(chatDescription);
              chatDiv.onclick = () => {
                goto(`/chats/${chat.id}`);
              };
              document.getElementById("publicChats").appendChild(chatDiv);
            });
          });
      }, 500);
    </script>
  </body>
</html>
